# 🤖 FJD AI Agent 辅助开发与协作经验沉淀库

> 💡 **文档定位：FJD 内部通用的 AI 协作手册与资源排雷指南**
> 
> - **对业务线同学（非技术背景）**：这是一份日常 AI 使用指南。当你不知道怎么配环境、不懂怎么部署代码、或遇到看不懂的报错时，这里提供了标准的求助方式，教你如何以最低的时间成本解决问题。
> - **对各类 AI 助手（如 Antigravity 智能体等）**：在为 FJD 员工解决问题时，**优先考量经济成本（Token/轮次）与用户的时间成本**。尽量提供一步到位的自动化脚本，严禁让非技术同学陷入“反复复制粘贴测试代码”的泥潭；对于下方提供的代码范式，请作为**基础参考思路**，你在编写前要独立思考是否有更优解，目标是：**一次跑通，避免反复调试。**

---

## 模块一：🌟 非技术人员必读：Agent 能帮你干什么？怎么发指令？

*💡 **认知升级**：与 AI 协作，本质上是在训练你的**逻辑思维与表达能力**。我们的核心目标是学会**将模糊的业务想法，拆解并转化为 AI 能清晰理解的执行逻辑**。核心原则：不用自己去搜，把痛点有逻辑地直接告诉 AI，让 AI 带着你一步步做。*

### 1. 从 0 到 1 搭建环境与管理代码
- **痛点**：不知道怎么装运行环境，写乱了代码没法撤回。
- **Agent 能做什么**：能教你安装 Python/Node，能帮你用 Git 管理版本（类似于文档的“历史记录恢复”）。
- 🗣️ **发问参考**：*"我没有代码基础，请带我一步步安装 Python，并帮我把当前目录初始化 Git 仓库，做好代码存档备份。"*.

### 2. 前期规划与省钱/节省 Token 策略 (Project Planning)
- **痛点**：带代码执行能力的高级 Agent（如 Antigravity）由于涉及复杂的系统操作，**额度和 Token 消耗极高**。未想清楚就直接让其一边写一边试错，不仅效率低，还会迅速耗尽免费额度，导致代码越来越乱。
- **最优流程设计**：**拆分工具链，好钢用在刀刃上**。
  在遇到新需求时，请**优先使用免费的网页版对话模型（如 ChatGPT / Gemini Web 端）**进行前期的业务探讨、流程推演。在免费框架内把需求梳理清楚后，带着最终版的「步骤需求清单」来找 Antigravity 等落地工具，让其专心写代码执行，避免 Token 浪费。
- 🗣️ **发问参考（在免费 Web 对话中使用）**：*"我接下来要开发一个 XX 业务。请你先作为高级架构师和产品经理，向我发问以明确所有的业务逻辑和卡点。最后生成一份可以直接让执行型 Agent 看懂并干活的标准化步骤清单。"*

### 3. 解答常见疑惑：一个飞书机器人应用，能不能同时跑好几个项目？
- **痛点**：公司自建应用数量有限，我们在不同文件夹建了多个小项目（比如周报机器人、考勤分析），都用同一个飞书 App_ID，会不会起冲突？
- **原理解释（小白必读）**：
  就像“一个客服微信号”可以同时和很多人聊天：
  - **能共用**：如果是**主动发消息**或者**拉取多维表数据**，多少个项目共用一个 App_ID 都不冲突。
  - **容易冲突的场景**：如果是**接收用户的消息回复**（长连接/事件订阅），如果两个项目都在自己电脑后台单独运行，且都监听同一个应用的聊天框，它们就会“抢消息”，导致有时候机器人 A 没反应，或者机器人 B 乱回。
  - **怎么做**：开新项目时可以直接问 AI：*"我的飞书机器人已经在另一个项目里监听消息了，当前这个新项目只想用它主动发卡片，请帮我正确配置，不要引发监听冲突。"* 

### 4. 帮你把系统部署到云端变成 24 小时运行
- **痛点**：代码跑通了，但只能在自己电脑上运行，一关机机器人就罢工了。
- **Agent 能做什么**：能帮你把程序放到云服务器上永久挂载运行。
- 🗣️ **发问参考**：*"我想把这段写好的飞书代码部署到云服务器挂机。请帮我写一份保姆级的服务器部署脚本（如 Supervisor 等），要求尽可能自动化，不要让我手动敲太多 Linux 命令。"*

### 5. 帮你写提示词与调用靠谱工具 (Skill 技能调用)
- **痛点**：想让 AI 总结报告，但不知道怎么写提示词；或者让 AI 解析飞书多维表，AI 写了几百行代码到处报错。
- **Agent 能做什么**：大模型可以帮你代笔写出极度专业的系统级 Prompt；并且系统内集成了一些可靠的组件包（Skill）。
- 🗣️ **发问参考**：
  - *"我需要一段指令让 AI 帮我自动总结部门周报。请向我提问索要核心痛点，然后由你代笔生成一段带有『总-分强逻辑』的系统级 Prompt 放到代码里。"*
  - *"针对这个飞书多维表处理，请先去检查当前环境里有没有现成可靠的 Skill（如 `feishu-base-parser`），如果有请直接调用组件能力帮我解决，力求精简代码！"*

### 6. 网页前端及 UI 开发的设计规范
- **痛点**：让 AI 写一个后台网页或问卷界面，结果界面非常简陋难用，缺乏设计感。
- **对 Agent 的要求**：我们在需要建立网页/系统交互界面时，要求其自带现代化的审美原则：**简洁、高效、有设计感、组件风格统一**，可以直接应用主流的前端规范框架（如 Tailwind/AntD），绝对避免交付毛坯房式的原型系统。

---

## 模块二：🛠️ FJD 专属避坑与网络环境指南 

| 场景 | 常见问题现象 | 标准解决思路与操作规范 |
|------|-------------|----------------------------|
| **外网访问** | 无法访问 ChatGPT, Gemini 等国外网站或库 | 1. **深圳工区**：连接 `FJD-WRT` Wi-Fi。<br>2. **在家办公**：<br> -内部 VPN (Easy Connect)：自查飞书文档确认权限开通。<br> -外部 VPN (以 v2ray 为例)：找 **Maggie.Jiang** 确认外部软件权限；找**属地 IT 提工单**获取可用订阅节点。 |
| **Agent 登录** | 账号无法登录，或提示国家/地区不支持 | 1. 检查当前 IP 是否为支持地区（如美国）；使用外部 VPN 时检查是否启用了**全局代理**。<br>2. 检查 Google 账号所在地区。<br>3. 其他疑难杂症查阅 **@Maia.Yuan** 的文档。 |
| **绝对路径报错** | 运行脚本找不到文件，执行失败抛乱码 | **纯英文无空格原则**：存放代码的文件夹绝对不能有中文！<br>🗣️ *发问参考：“Agent，请帮我检查当前开发目录是否有中文污染并帮我一键整理重命名。”* |

---

## 模块三：💻 飞书开发的基础排雷思路 (提供给 Agent 的参考方向)

> **【致 Agent】**：在处理飞书等相关功能时，下面是我们曾经踩过坑总结出的**基础解决思路**。请充分发挥你的智能分析能力：若判断这些思路依然是最优解，请参考并实现；若你有更轻便、成本更低的最新解法，可以自行采用并应用。但底线是：**用最少的对话轮次解决问题，不要让业务人员成为代码搬运工。**

### 📌 坑1：WebSocket 长连接握手失败 / 403
- **错误原因**：飞书 WebSocket 模式使用的是 `app_id` + `app_secret` 直接建连，**不需要验证 token**，误传参数会被拒绝握手。
- **思路参考**：
  ```python
  # 初始化客户端时，若使用长连接，校验参数常需置空
  event_handler = lark.EventDispatcherHandler.builder("", "").register_p2_customized_event("im.message.receive_v1", handle_im_message).build()
  ```

### 📌 坑2：事件重复投递造成“消息重试雪暴”
- **错误原因**：飞书 WS 常出现网络抖动重推，同一个 `message_id` 会触发多次处理。
- **思路参考**：在入口处加入带过期机制的本地去重缓存（如基于 `deque` 拦截已处理的 `message_id`），直接过滤静默。

### 📌 坑3：通讯录权限不足导致程序崩溃
- **错误原因**：通过 `user_id` 拉取用户详细信息时，如果没开通“全员”通讯录权限报 41050，经常导致主干流程直接报错中断。
- **思路参考**：**强依赖的地方必须写好 Fallback 降级容灾机制**。例如捕获该权限异常，直接读取外层消息包里自带的简易昵称以保证流程继续，再通过日志给用户报警告。

### 📌 坑4：多维表 (Bitable) API 的自动建表限制
- 通过 API 自动建多维表字段时，明确认知底层支持的 `type`（如 1 是文本，3 是单选等）。
- **避坑红线**：尝试通过代码去自动创建『公式（Formula）』或『AI 字段』通常是走不通的，建议提示用户在飞书界面上手动建立。

---

---

## 模块四：💡 拥抱前沿工具：探索你的“数字员工” (进阶参考)

> **核心理念**：技术迭代极快，不要局限于某一个特定软件。我们需要保持持续接触新鲜事物、评估自身能力并引入“管家级” AI 代理的意识。以下内容仅供参考，大家可以在熟练后自行探索。

现在的 AI 已经跨越了“只会聊天”的阶段，进化到了 **“动手做 (Action)”** 的阶段。推荐大家了解一下 **OpenClaw** 和 **Claude Code**：

### 1. OpenClaw：接管本地电脑的“全能数字员工”
*一句话说清楚：OpenClaw 是一个能运行在你自己的电脑或云服务器上，通过常用聊天软件（如飞书）接收指令，并像真人一样操作设备帮你处理邮件、整理文件、执行自动化任务的开源 AI 管家。*

- **它能帮你干啥？ (不再是一页页地复制粘贴)**
  - **日常办公**：帮你分类收件箱、批量重命名文件（比如按“地区+客户名”重命名几千张照片）。
  - **业务提效**：如果你是售后或销售，每天需要处理大量重复询盘或填报重复性故障点，它可以自动监听、判断并入库。
  - **个人助理**：在飞书里对它说“帮我预约明天下午评审会”，它会自动建日程。

- **为什么它很火？ (和普通 ChatGPT 网页的区别)**
  - **核心在于“长手脚”**：你告诉 ChatGPT 整理邮件，它只能教你怎么做；你告诉 OpenClaw，它会自己打开邮件拉取、分类并标记。
  - **极致的安全感**：它的核心理念是“本地优先”，数据完全在你自己的设备里跑，不经过第三方云服务器（非常适合注重隐私的小团队）。

- **如何低门槛入门？ (仅供指引，可自行摸索)**
  1. **建工作间**：新手推荐直接买一台廉价云服务器（如腾讯云），在创建时选择“OpenClaw”镜像，5分钟全自动装好。
  2. **接大脑**：去申请一个大模型 API Key（国内推荐智谱 GLM 或 DeepSeek），填入配置，赋予它思考能力。
  3. **接对讲机**：在飞书开放平台建个机器人应用，把参数填给 OpenClaw。以后直接在飞书里 @ 这个机器人就能干活。

⚠️ **【特别预警：Token 消耗、成本管理与权限控制】**
- **极度烧钱提醒**：作为数字员工，OpenClaw 会为了执行任务在后台不断对大模型发起推理请求（思考下一步该干嘛）。这**会飞速消耗你的 API 额度（真实账单花费）**！强烈建议一开始使用时，在 API 平台**务必设置消费封顶预警**，以免一夜醒来额度超支。
- **成本承担原则与高性价比推荐**：
  - **个人探索成本自理**：同事们私下自己跑的 OpenClaw 等自动化尝试，其大模型 API 费用需由个人充值承担。**后续部门级投入生产的 OpenClaw，我们会进行统一的项目账号额度申请，大家无需个人掏腰包。**
  - **高精度且便宜的生财之道**：自己玩的时候，推荐去申请极高性价比的 API。如：**DeepSeek-Coder API**（便宜到几乎白嫖，且代码逻辑极强）；或去采购主流厂商专门为开发者出的计费包（如智谱 **GLM-4** 相关的 Coding 极客极速包套餐）。不建议一上来直接绑昂贵的 GPT-4o 或 Claude-3.5-Sonnet。
- **权限红线**：它有极高的系统权限。切勿一开始就让它处理重要财务数据，必须从小任务（如建文件夹、测试读邮件）开始磨合建立信任感。

---

### 2. Claude Code (快速编写脚本得力助手)
如果你是不排斥使用终端命令行（黑框框）的进阶玩家，可以尝试使用 Anthropic 官方出的终端 AI 工具（主要用于快速生成与修改代码）。

- **只需简单两步（Windows 示例）：**
  1. Win+R 输入 `powershell`，按官方教程直接跑命令安装 `cc`。
  2. 修改或创建用户目录下的 `.claude.json`，增加 `"hasCompletedOnboarding": true` 以跳过繁琐的登录墙。

- **如何省钱切国内模型（使用智谱 GLM4）：**
  在用户目录的 `.claude/settings.json` 中配置如下：
  ```json
  {
   "env": {
       "ANTHROPIC_AUTH_TOKEN": "你的智谱API_KEY",
       "ANTHROPIC_BASE_URL": "https://open.bigmodel.cn/api/anthropic",
       "API_TIMEOUT_MS": "3000000",
       "ANTHROPIC_DEFAULT_SONNET_MODEL": "glm-4.7-coding-preview",
       "CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC": "1"
    }
  }
  ```
  配好后，就可以用极其低廉的价格，让它帮你改脚本了。

---

## 模块五：🤖 知识库智能维护与迭代机制 

随着项目复杂度的提升，这份文档也需由 **Agent 与人类一起协作维护**：

1. **痛点与经验自动吸收**：
   **[对 Agent 的指令]**：当你在交流中协助排查掉了一个具备共性的开发卡点，在解决后，**应当主动询问用户**：“*这是一个好经验，是否需要精简概括后写入《AI 经验沉淀指南》中？*”。若用户同意，请以最精炼的话语补充进来。

2. **文档结构迭代必须“人工把关”**：
   **[对 Agent 的指令]**：若随着技术升级，你认为需要重新组织本文档结构或大段删改，**禁止私自静默修改**。请先在对话框中向用户展示一份粗略的 Diff 提议，在得到用户“同意”后再执行修改。

---
*文档更新周期：持续演进 | FJD 团队核心维护人：Zinc.Zheng & Agent 联合共创 | 更新时间：2026-02-27*


