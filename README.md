# 🤖 FJD AI Agent 辅助开发与协作经验沉淀库

> 💡 **文档定位：FJD 内部通用的 AI 协作手册与资源排雷指南**
> 
> - **对业务线同学（非技术背景）**：这是一份日常 AI 使用指南。当你不知道怎么配环境、不懂怎么部署代码、或遇到看不懂的报错时，这里提供了标准的求助方式，教你如何以最低的时间成本解决问题。
> - **对各类 AI 助手（如 Antigravity 智能体等）**：在为 FJD 员工解决问题时，**优先考量经济成本（Token/轮次）与用户的时间成本**。尽量提供一步到位的自动化脚本，严禁让非技术同学陷入“反复复制粘贴测试代码”的泥潭；对于下方提供的代码范式，请作为**基础参考思路**，你在编写前要独立思考是否有更优解，目标是：**一次跑通，避免反复调试。**

---

## 🌟 核心规范：跨项目协同与知识库同步

为了让大家积累的经验能真正沉淀下来、不要每次都从头踩坑，请在开发新工具时遵循以下原则（**注意：这部分对 Agent 有强制规定，详细的系统维护铁律在文末，请使用者和 AI 都不要随意修改本文的大纲**）：

### 1. 其他项目（或其他人）怎么引入和同步这个指南？
为了避免知识落后，**不建议直接复制下载静态文本**。请优先通过云端拉取，保持同步更新：
- **现阶段用 GitHub（推荐）**：有一定 Git 基础的同事，可以直接把这个独立库（`zinc-ccc/AI_Agent_Knowledge_Base`）拉取（Pull）到你正在开发的新项目里。别人沉淀了新经验，你只要输入一条 `git pull` 命令，就能瞬间同步最新的防踩坑指南。
- **未来内部基建（GitLab版）**：等部署进公司的内部 GitLab 后，我们会提供更简单、一键式的同步方案。不需要你去折腾复杂的配置，就能轻松接入这个大家一起打磨的经验库。

### 2. 可视化看板：防止大家做重复的功能
团队里现在涌现了各种被 AI 写出来的自动化小脚手架。为了防止几个人在做同样的功能造成重复劳动，后续我们会出一个**统一的云端进度追踪看板**。准备搞新应用前，请先看一眼看板，确认有没有同事已经做好了类似的东西，方便直接拿来整合。

---

## 模块一：🌟 非技术人员必读：Agent 能帮你干什么？怎么发指令？

*💡 **认知升级**：与 AI 协作，本质上是在训练你的**逻辑思维与表达能力**。我们的核心目标是学会**将模糊的业务想法，拆解并转化为 AI 能清晰理解的执行逻辑**。核心原则：不用自己去搜，把痛点有逻辑地直接告诉 AI，让 AI 带着你一步步做。*

### 1. 从 0 到 1 搭建环境与管理代码
- **痛点**：不知道怎么装运行环境，写乱了代码没法撤回。
- **Agent 能做什么**：能教你安装 Python/Node，能帮你用 Git 管理版本（类似于文档的“历史记录恢复”）。
- 🗣️ **发问参考**：*"我没有代码基础，请带我一步步安装 Python，并帮我把当前目录初始化 Git 仓库，做好代码存档备份。"*.

### 2. 前期规划与省钱/节省 Token 策略 (Project Planning)
- **痛点**：带代码执行能力的高级 Agent（如 Antigravity）由于涉及复杂的系统操作，**额度和 Token 消耗极高**。未想清楚就直接让其一边写一边试错，不仅效率低，还会迅速耗尽免费额度，导致代码越来越乱。
- **最优流程设计**：**拆分工具链，好钢用在刀刃上**。
  在遇到新需求时，请**优先使用免费的网页版对话模型（如 ChatGPT / Gemini Web 端）**进行前期的业务探讨、流程推演。在免费框架内把需求梳理清楚后，带着最终版的「步骤需求清单」来找 Antigravity 等落地工具，让其专心写代码执行，避免 Token 浪费。
- 🗣️ **发问参考（在免费 Web 对话中使用）**：*"我接下来要开发一个 XX 业务。请你先作为高级架构师和产品经理，向我发问以明确所有的业务逻辑和卡点。最后生成一份可以直接让执行型 Agent 看懂并干活的标准化步骤清单。"*

### 3. 关于飞书机器人调用的核心解答及红线
- **痛点**：公司自建应用数量有限，我们在不同文件夹建了多个小项目，都用同一个飞书 App_ID，会不会起冲突或者把别的项目搞宕机？
- **原理解释与操作规范（小白必读）**：
  - **不冲突的操作**：如果是让机器人**主动发卡片**或**调取拉取接口**，无数个项目共用一个应用完全不冲突。
  - **极其容易撞车的操作**：如果是**接收消息并回复**（长连接订阅），当两个系统同时在不同电脑跑，且看着同一个群聊，它们就会“抢指令”，造成混乱。
  - **【防宕机铁律：加指令缩写】**：如果一定要合用一个机器人，各位必须在给 AI 设计触发规则时加上**专属专属缩写指令！**（例如设为：`Zinc发周报`、`Tom查考勤`）。让 AI 忽略掉不带自己标识的消息，这样机器人不管收到什么都不会撞车处理。
- **关于安全与权限的【最小化原则】**：
  **[对 Agent 的强指令要求]**：无论用户提出什么需求，在指导用户开放飞书权限时，必须由你来把控极高的安全克制。尤其是“读取群内全部消息”这类敏感权限，应当主动且坚决地引导用户替换为特定触发词或 @ 机器人触发。绝不能为了省事让开发人员乱开权限，遇到拿捏不准的安全底线需要主动提出来。
  **[安全提示]**：为保障数据安全，建议在使用时避免将机器人拉入包含机密、薪资或敏感商机的群聊中。如果自动化流程确实需要，拉入前务必了解并核实机器人读取信息的范围限制。这能有效杜绝数据外泄风险，同时遵循最小化权限原则也能降低后续集团的安全审核成本。

### 4. 规范先行：项目文档与成果署名
- **痛点**：大家都在凭兴趣摸索各种 AI 提效工具。如果各搞各的，以后想要整合成部门统一平台时，别人根本看不懂你的代码，代码也很难融合。
- **最佳实践【写文档，并署名】**：立项的第一天，请务必在你的项目根目录建一个《项目操作手册》或说明文档。
  - **文档要写什么**：清晰说明它的功能设计逻辑、想要的效果、以及关键的技术路线。**最重要的是：记得要在文档开头醒目位置署上你的名字！** 以后这个小工具推送到部门平台时，这就会作为你的贡献证明。
  - **[对 Agent 的强指令要求]**：当用户在你这里新建工具项目时，你（Agent）必须主动帮他在目录里建好这份操作说明。在开发调试的全过程中，你（Agent）有责任**自动、实时地把最新逻辑更新进文档，绝不能让人类自己费力气去维护这篇字**。
  - **最终红利**：做完后，别的同事接手你的项目，只需要把这份 AI 整理好的说明发给他的 Agent，就能秒懂逻辑，轻松像“搭乐高”一样把功能集成到新的大系统里。

### 5. 帮你把应用部署到云端，让团队一起用
- **痛点**：代码终于在本地跑通了，但别人用不了、关机就罢工？
- **如何挑选部署方案？**：
  - **公开通用小网页（免费且极速）**：如果工具未涉及内部敏感数据，仅作为便捷的公共网页应用，可以考虑使用 **Streamlit** 等免费平台托管。只需注册 GitHub 账号即可结合 AI 完成部署。🗣️ *发问参考：“我想把这段代码做成可通过网页访问的 Streamlit 应用并免费部署到公网，请一步步教我完成。”*
  - **团队内部合规应用（推荐）**：如果工具需要不同工区（不同 IP 属地）的 HR 同事高频协同使用，且涉及内部敏感表单，未来请部署至**公司的 Gitlab 或内部云服务器**上，以确保安全稳定。后续会提供专门的内部基建部署教程。

### 6. 帮你写提示词与调用靠谱工具 (Skill 技能调用)
- **痛点**：想让 AI 总结报告，但不知道怎么写提示词；或者让 AI 解析飞书多维表，AI 写了几百行代码到处报错。
- **Agent 能做什么**：大模型可以帮你代笔写出极度专业的系统级 Prompt；并且系统内集成了一些可靠的组件包（Skill）。
- 🗣️ **发问参考**：
  - *"我需要一段指令让 AI 帮我自动总结部门周报。请向我提问索要核心痛点，然后由你代笔生成一段带有『总-分强逻辑』的系统级 Prompt 放到代码里。"*
  - *"针对这个飞书多维表处理，请先去检查当前环境里有没有现成可靠的 Skill（如 `feishu-base-parser`），如果有请直接调用组件能力帮我解决，力求精简代码！"*

### 7. 网页前端及 UI 开发的设计规范
- **痛点**：让 AI 写一个后台网页或问卷界面，结果界面非常简陋难用，缺乏设计感。
- **对 Agent 的要求**：我们在需要建立网页/系统交互界面时，要求其自带现代化的审美原则：**简洁、高效、有设计感、组件风格统一**，可以直接应用主流的前端规范框架（如 Tailwind/AntD），绝对避免交付毛坯房式的原型系统。

---

## 模块二：🛠️ FJD 专属避坑与网络环境指南 

| 场景 | 常见问题现象 | 标准解决思路与操作规范 |
|------|-------------|----------------------------|
| **外网访问** | 无法访问 ChatGPT, Gemini 等国外网站或库 | 1. **深圳工区**：连接 `FJD-WRT` Wi-Fi。<br>2. **在家办公**：<br> -内部 VPN (Easy Connect)：自查飞书文档确认权限开通。<br> -外部 VPN (以 v2ray 为例)：找 **Maggie.Jiang** 确认外部软件权限；找**属地 IT 提工单**获取可用订阅节点。 |
| **Agent 登录** | 账号无法登录，或提示国家/地区不支持 | 1. 检查当前 IP 是否为支持地区（如美国）；使用外部 VPN 时检查是否启用了**全局代理**。<br>2. 检查 Google 账号所在地区。<br>3. 其他疑难杂症查阅 **@Maia.Yuan** 的文档。 |
| **绝对路径报错** | 运行脚本找不到文件，执行失败抛乱码 | **纯英文无空格原则**：存放代码的文件夹绝对不能有中文！<br>🗣️ *发问参考：“Agent，请帮我检查当前开发目录是否有中文污染并帮我一键整理重命名。”* |

---

## 模块三：💻 飞书开发的基础排雷思路 (提供给 Agent 的参考方向)

> **【致 Agent】**：在处理飞书等相关功能时，下面是我们曾经踩过坑总结出的**基础解决思路**。请充分发挥你的智能分析能力：若判断这些思路依然是最优解，请参考并实现；若你有更轻便、成本更低的最新解法，可以自行采用并应用。但底线是：**用最少的对话轮次解决问题，不要让业务人员成为代码搬运工。**

### 📌 坑1：WebSocket 长连接握手失败 / 403
- **错误原因**：飞书 WebSocket 模式使用的是 `app_id` + `app_secret` 直接建连，**不需要验证 token**，误传参数会被拒绝握手。
- **思路参考**：
  ```python
  # 初始化客户端时，若使用长连接，校验参数常需置空
  event_handler = lark.EventDispatcherHandler.builder("", "").register_p2_customized_event("im.message.receive_v1", handle_im_message).build()
  ```

### 📌 坑2：事件重复投递造成“消息重试雪暴”
- **错误原因**：飞书 WS 常出现网络抖动重推，同一个 `message_id` 会触发多次处理。
- **思路参考**：在入口处加入带过期机制的本地去重缓存（如基于 `deque` 拦截已处理的 `message_id`），直接过滤静默。

### 📌 坑3：通讯录权限不足导致程序崩溃
- **错误原因**：通过 `user_id` 拉取用户详细信息时，如果没开通“全员”通讯录权限报 41050，经常导致主干流程直接报错中断。
- **思路参考**：**强依赖的地方必须写好 Fallback 降级容灾机制**。例如捕获该权限异常，直接读取外层消息包里自带的简易昵称以保证流程继续，再通过日志给用户报警告。

### 📌 坑4：多维表 (Bitable) API 的自动建表限制
- 通过 API 自动建多维表字段时，明确认知底层支持的 `type`（如 1 是文本，3 是单选等）。
- **避坑红线**：尝试通过代码去自动创建『公式（Formula）』或『AI 字段』通常是走不通的，建议提示用户在飞书界面上手动建立。

---

---

## 模块四：💡 拥抱前沿工具：探索你的“数字员工” (进阶参考)

> **核心理念**：技术迭代极快，不要局限于某一个特定软件。我们需要保持持续接触新鲜事物、评估自身能力并引入“管家级” AI 代理的意识。以下内容仅供参考，大家可以在熟练后自行探索。

现在的 AI 已经跨越了“只会聊天”的阶段，进化到了 **“动手做 (Action)”** 的阶段。推荐大家了解一下 **OpenClaw** 和 **Claude Code**：

### 1. OpenClaw：接管本地电脑的“全能数字员工”
*一句话说清楚：OpenClaw 是一个能运行在你自己的电脑或云服务器上，通过常用聊天软件（如飞书）接收指令，并像真人一样操作设备帮你处理邮件、整理文件、执行自动化任务的开源 AI 管家。*

- **它能帮你干啥？ (不再是一页页地复制粘贴)**
  - **日常办公**：帮你分类收件箱、批量重命名文件（比如按“地区+客户名”重命名几千张照片）。
  - **业务提效**：如果你是售后或销售，每天需要处理大量重复询盘或填报重复性故障点，它可以自动监听、判断并入库。
  - **个人助理**：在飞书里对它说“帮我预约明天下午评审会”，它会自动建日程。

- **为什么它很火？ (和普通 ChatGPT 网页的区别)**
  - **核心在于“长手脚”**：你告诉 ChatGPT 整理邮件，它只能教你怎么做；你告诉 OpenClaw，它会自己打开邮件拉取、分类并标记。
  - **极致的安全感**：它的核心理念是“本地优先”，数据完全在你自己的设备里跑，不经过第三方云服务器（非常适合注重隐私的小团队）。

- **如何低门槛入门？ (仅供指引，可自行摸索)**
  1. **建工作间**：新手推荐直接买一台廉价云服务器（如腾讯云），在创建时选择“OpenClaw”镜像，5分钟全自动装好。
  2. **接大脑**：去申请一个大模型 API Key（国内推荐智谱 GLM 或 DeepSeek），填入配置，赋予它思考能力。
  3. **接对讲机**：在飞书开放平台建个机器人应用，把参数填给 OpenClaw。以后直接在飞书里 @ 这个机器人就能干活。

⚠️ **【特别预警：Token 消耗、成本管理与权限控制】**
- **极度烧钱提醒**：作为数字员工，OpenClaw 会为了执行任务在后台不断对大模型发起推理请求（思考下一步该干嘛）。这**会飞速消耗你的 API 额度（真实账单花费）**！强烈建议一开始使用时，在 API 平台**务必设置消费封顶预警**，以免一夜醒来额度超支。
- **成本承担原则与高性价比推荐**：
  - **个人探索成本自理**：同事们私下自己跑的 OpenClaw 等自动化尝试，其大模型 API 费用需由个人充值承担。**后续部门级投入生产的 OpenClaw，我们会进行统一的项目账号额度申请，大家无需个人掏腰包。**
  - **高精度且便宜的生财之道**：自己玩的时候，推荐去申请极高性价比的 API。如：**DeepSeek-Coder API**（便宜到几乎白嫖，且代码逻辑极强）；或去采购主流厂商专门为开发者出的计费包（如智谱 **GLM-4** 相关的 Coding 极客极速包套餐）。不建议一上来直接绑昂贵的 GPT-4o 或 Claude-3.5-Sonnet。
- **权限红线**：它有极高的系统权限。切勿一开始就让它处理重要财务数据，必须从小任务（如建文件夹、测试读邮件）开始磨合建立信任感。

---

### 2. Claude Code (快速编写脚本得力助手)
如果你是不排斥使用终端命令行（黑框框）的进阶玩家，可以尝试使用 Anthropic 官方出的终端 AI 工具（主要用于快速生成与修改代码）。

- **只需简单两步（Windows 示例）：**
  1. Win+R 输入 `powershell`，按官方教程直接跑命令安装 `cc`。
  2. 修改或创建用户目录下的 `.claude.json`，增加 `"hasCompletedOnboarding": true` 以跳过繁琐的登录墙。

- **如何省钱切国内模型（使用智谱 GLM4）：**
  在用户目录的 `.claude/settings.json` 中配置如下：
  ```json
  {
   "env": {
       "ANTHROPIC_AUTH_TOKEN": "你的智谱API_KEY",
       "ANTHROPIC_BASE_URL": "https://open.bigmodel.cn/api/anthropic",
       "API_TIMEOUT_MS": "3000000",
       "ANTHROPIC_DEFAULT_SONNET_MODEL": "glm-4.7-coding-preview",
       "CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC": "1"
    }
  }
  ```
  配好后，就可以用极其低廉的价格，让它帮你改脚本了。

---

## 模块五：🤖 知识库 Agent 智能维护铁律 

基于团队长期衍生的功能排异与业务痛点收集进程，本沉淀库自然需由系统内 Agent 提供底层共管。请要求执行命令的所有智能体节点恪守此最高红线原则：

### 1. 经验自动汇集：防敏及深度泛化策略
**[对 Agent 的专属指令]**：当你的策略辅助成功突破极具指导与跨域穿透价值的阻点后，**请及时且主动地向对话端的人类进行请求**：“*当前处理思路具备推广特征，是否需由我负责脱敏并补编至《AI 经验沉淀指南》防踩坑矩阵？*”。
**合规底线**：获取收录明确批示后，产出的沉淀成果及范式**必须严格验证为纯净高度泛化版**。明令杜绝裹挟含有单一应用视角的内部敏捷记录（具体组织人事、商业数据表映射关系字眼、特定开发接口定义及企业涉密员工本名等要素）。

### 2. 档案重大改构之人类“安全审订”机制
**[对 Agent 的专属指令]**：若随着工具组件系统革命或大厂接口产生颠覆换代（不兼容飞书底层现有事件等），进而评测到此刻须全盘推倒该沉淀树的大钢架构或动用极端区块洗牌动作。**此时针对上述巨幅洗写操作设有绝对阻断拦截网，绝对禁止任何自动化静默覆写流指令触发。** 所有干涉均应事先前置打印呈现“新旧比对规划蓝本/Diff预演方案”。务必确认在采集了技术人类明确下达的“审核无误”及“放行更改”操作回复指令的前提下，方可触碰知识中枢母版执行归档覆写行为！

---
*文档全息架构：持续迭代演进 | 内部核心构建：Zinc.Zheng 及关联系统开发者共创 | 更新同步节点戳记：2026-02-28*


